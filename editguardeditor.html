<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
  <meta name="author" content="GeeksLabs">
  <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
  <link rel="shortcut icon" href="img/favicon.png">
  <title>GTS Project</title>
  <!-- Bootstrap CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <!-- bootstrap theme -->
  <link href="css/bootstrap-theme.css" rel="stylesheet">
  <!--external css-->
  <!-- font icon -->
  <link href="css/elegant-icons-style.css" rel="stylesheet" />
  <link href="css/font-awesome.min.css" rel="stylesheet" />
  <!-- owl carousel -->
  <link rel="stylesheet" href="css/owl.carousel.css" type="text/css">
  <link href="css/jquery-jvectormap-1.2.2.css" rel="stylesheet">
  <!-- Custom styles -->
  <link rel="stylesheet" href="css/fullcalendar.css">
  <link href="css/widgets.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet" />
  <link href="css/xcharts.min.css" rel=" stylesheet">
  <link href="css/jquery-ui-1.10.4.min.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
  <!-- container section start -->
  <section id="container" class="">
    <header class="header dark-bg">
      <div class="toggle-nav">
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"><i class="icon_menu"></i></div>
      </div>
      <!--logo start-->
      <a href="index.html" class="logo">GTS<span class="lite">KMUTNB</span></a>
      <!--logo end-->
      <div class="top-nav notification-row">
        <!-- notificatoin dropdown start-->
        <ul class="nav pull-right top-menu">
          <a class="" href="index.html">
            คุณ <div id="result"></div>
          <span class="" onclick="logout()">Logout</span>
        </a>
        </ul>
        <!-- notificatoin dropdown end-->
      </div>
    </header>
    <!--header end-->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
          <!-- sidebar menu start-->
          <ul class="sidebar-menu">
            <li class="active">
              <a class="" href="editor.html">
                <i class="icon_table"></i>
                <span>แสดงผลการทำงาน</span>
              </a>
            </li>
            <li class="active">
              <a class="" href="addguardeditor.html">
                <i class="icon_document_alt"></i>
                <span>เพิ่มข้อมูลเจ้าหน้าที่รักษาความปลอดภัย</span>
              </a>
            </li>
            <li class="active">
              <a class="" href="guardeditor.html">
                <i class="icon_pencil-edit_alt"></i>
                <span>ดูข้อมูลเจ้าหน้าที่รักษาความปลอดภัย</span>
              </a>
            </li>
            <li class="active">
              <a class="" href="usereditor.html">
                <i class="icon_pencil-edit_alt"></i>
                <span>ดูข้อมูลผู้ใช้งาน</span>
              </a>
            </li>
            <li class="active">
              <a class="" href="grapheditor.html">
                <i class="icon_piechart"></i>
                <span>กราฟแสดงผล</span>
              </a>
            </li>
          </ul>
        </div>
      </aside>
      <!-- sidebar menu end-->
    <!--main content start-->
    <section id="main-content">
      <section class="wrapper">
        <!--overview start-->
        <div class="row">
          <div class="col-lg-12">
            <h3 class="page-header"><i class="icon_document_alt"></i>แก้ไขข้อมูลเจ้าหน้าที่รักษาความปลอดภัย</h3>
          </div>
        </div>
        <div class="row">
           <div class="col-lg-12">
             <section class="panel">
               <header class="panel-heading">
                 กรุณาแก้ไขข้อมูล
               </header>
               <div class="panel-body">
                 <div class="form">
                   <form class="form-validate form-horizontal " id="register_form" method="get" action="">
                     <div class="form-group ">
                       <label for="gid" class="control-label col-lg-2">* รหัสประจำตัว</label>
                       <div class="col-lg-10">
                         <input class=" form-control" id="gid" name="id" type="number" />
                       </div>
                     </div>
                     <div class="form-group ">
                       <label for="tagid" class="control-label col-lg-2">* Tag ID</label>
                       <div class="col-lg-10">
                         <input class=" form-control" id="tagid" name="tag" type="number" />
                       </div>
                     </div>
                     <div class="form-group ">
                       <label for="name" class="control-label col-lg-2">* ชื่อจริง</label>
                       <div class="col-lg-10">
                         <input class=" form-control" id="name" name="fullname" type="text" />
                       </div>
                     </div>
                     <div class="form-group ">
                       <label for="lastname" class="control-label col-lg-2">* นามสกุล</label>
                       <div class="col-lg-10">
                         <input class=" form-control" id="lastname" name="lasname" type="text" />
                       </div>
                     </div>
                     <div class="form-group ">
                       <label for="phone" class="control-label col-lg-2">* เบอร์โทรศัพท์</label>
                       <div class="col-lg-10">
                         <input class=" form-control" id="phone" name="tel" type="tel" />
                       </div>
                     </div>
                     <div class="form-group ">
                       <label for="idna" class="control-label col-lg-2">* รหัสประชาชน</label>
                       <div class="col-lg-10">
                         <input class=" form-control" id="idna" name="idn" type="naid" />
                       </div>
                     </div>
                     <div class="form-group ">
                       <label for="address" class="control-label col-lg-2">* ที่อยู่</label>
                       <div class="col-lg-10">
                         <input class=" form-control" id="address" name="add" type="text" />
                       </div>
                     </div>
                     <!-- <div class="form-group ">
                      <label for="showpic" class="control-label col-lg-2">* รูปภาพ</label>
                      <div class="col-lg-10">
                          <img src="gs://gtslogic.appspot.com" id="thumbnail"/>
                      </div>
                    </div> -->
                     <!-- <div class="form-group ">
                      <label for="pic" class="control-label col-lg-2">* แก้ไขรูปภาพ</label>
                      <div class="col-lg-10">
                          <input type="file" id="fileButton"/>
                      </div>
                    </div> -->
                     <div class="form-group">
                       <div class="col-lg-offset-2 col-lg-10">
                         <button class="btn btn-primary" id="add-data" type="submit">บันทึก</button>
                         <button class="btn btn-default" type="button"><a href="guardeditor.html">ยกเลิก</a></button>
                       </div>
                     </div>
                   </form>
                 </div>
               </div>
             </section>
           </div>
         </div>
        <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
        <script src="js/config.js"></script>
        <script>
        var searchParams = new URLSearchParams(window.location.search);
        console.log("QueryString",searchParams.get("id"))
        var thumbnail;
        database.ref("guards/data/").once('value', function(snapshot){
              if(snapshot.exists()){
                var content = '';
                snapshot.forEach(function(data){
                  var val = data.val();
                  var get_id;
                  console.log("id",data.getKey());
                  get_id = data.getKey();
                  if(get_id == searchParams.get("id")){
                    console.log("gid",val.gid);
                    console.log("tagid",val.tagid);
                    console.log("name",val.name);
                    console.log("lastname",val.lastname);
                    console.log("phone",val.phone);
                    console.log("idna",val.idna);
                    console.log("address",val.address);
                    console.log("thumbnail", val.thumbnail);
                    document.getElementById("gid").value = ""+val.gid;
                    document.getElementById("name").value = ""+val.name;
                    document.getElementById("lastname").value = ""+val.lastname;
                    document.getElementById("gid").value = ""+val.gid;
                    document.getElementById("phone").value = ""+val.tel;
                    document.getElementById("idna").value = ""+val.cardid;
                    document.getElementById("address").value = ""+val.address;
                    document.getElementById("tagid").value = ""+val.tagid;
                    if(document.getElementById("thumbnail").value == ""){
                      var fileButton = document.getElementById("fileButton");
                      fileButton.addEventListener('change', function(e){
                        var file = e.target.files[0];
                        var storageRef = firebase.storage().ref(file.name);
                        storageRef.put(file);
                        thumbnail = "https://firebasestorage.googleapis.com/v0/b/"+config["storageBucket"]+"/o/"+file.name+"?alt=media";
                      });
                    }
                    }
                    });
                    }
                    });

        document.getElementById("add-data").onclick = function(e) {
          var gid = document.getElementById('gid').value;
          var name = document.getElementById('name').value;
          var lastname = document.getElementById('lastname').value;
          var tel = document.getElementById('phone').value;
          var cardid = document.getElementById('idna').value;
          var address = document.getElementById('address').value;
          var tagid = document.getElementById('tagid').value;
          var rootRef = firebase.database().ref();
          var storesRef = rootRef.child('guards/data/'+searchParams.get("id"));
             storesRef.set({
                gid: gid,
                name: name,
                lastname: lastname,
                tel: tel,
                cardid: cardid,
                address: address,
                tagid: tagid,
                // thumbnail: thumbnail
                });
                alert("ข้อมูลถูกบันทึกแล้ว");
                ;}
                $('input[type ="tel"]').on('keypress', function(){
                  if( $(this).val().length > 9){
                    return false;
                  }
                });
                console.log($('input[type ="tel"]'));
                $('input[type ="naid"]').on('keypress',function(){
                  if($(this).val().length > 12){
                    return false;
                  }
                });
                console.log($('input[type = "naid"]'));
</script>
</body>
</html>
