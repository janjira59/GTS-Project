<!DOCTYPE html>
<html lang="en">

<head>
  <script>
        var local = localStorage.getItem("session");
          if (local === "undefined" || local === null) {
           
            window.location.href = "../index.html";
          }
    </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
  <meta name="author" content="GeeksLabs">
  <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
  <link rel="shortcut icon" href="img/favicon.png">

  <title>GTS Project</title>

  <!-- Bootstrap CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <!-- bootstrap theme -->
  <link href="css/bootstrap-theme.css" rel="stylesheet">
  <!--external css-->
  <!-- font icon -->
  <link href="css/elegant-icons-style.css" rel="stylesheet" />
  <link href="css/font-awesome.min.css" rel="stylesheet" />
  <!-- owl carousel -->
  <link rel="stylesheet" href="css/owl.carousel.css" type="text/css">
  <link href="css/jquery-jvectormap-1.2.2.css" rel="stylesheet">
  <!-- Custom styles -->
  <link rel="stylesheet" href="css/fullcalendar.css">
  <link href="css/widgets.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet" />
  <link href="css/xcharts.min.css" rel=" stylesheet">
  <link href="css/jquery-ui-1.10.4.min.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</head>

<body>
  <!-- container section start -->
  <section id="container" class="">
    <header class="header dark-bg">
      <div class="toggle-nav">
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"><i class="icon_menu"></i></div>
      </div>
      <!--logo start-->
      <a href="admin.html" class="logo">GTS<span class="lite">KMUTNB</span></a>
      <!--logo end-->
      <div class="nav search-row" id="top_menu">
      </div>
      <div class="top-nav notification-row">
        <!-- notificatoin dropdown start-->
        <ul class="nav pull-right top-menu">
            <a class="" href="index.html">
                คุณ <div id="result"></div>
              <span class="" onclick="logout()">Logout</span>
            </a>
        </ul>
        <!-- notificatoin dropdown end-->
      </div>
    </header>
    <!--header end-->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
          <!-- sidebar menu start-->
          <ul class="sidebar-menu">
            <li class="active">
              <a class="" href="admin.html">
                <i class="icon_table"></i>
                <span>แสดงผลการทำงาน</span>
              </a>
            </li>
            <li class="active">
              <a class="" href="adduseradmin.html">
                <i class="icon_document_alt"></i>
                <span>เพิ่มข้อมูลผู้ใช้งาน</span>
              </a>
            </li>
            <li class="active">
              <a class="" href="useradmin.html">
                <i class="icon_pencil-edit_alt"></i>
                <span>ดูข้อมูลผู้ใช้งาน</span>
              </a>
            </li>
            <li class="active">
              <a class="" href="graphadmin.html">
                <i class="icon_piechart"></i>
                <span>กราฟแสดงผล</span>
              </a>
            </li>
            <li class="active">
                <a class="" href="analyst.html">
                  <i class=""></i>
                  <span>ดูหน้า User</span>
                </a>
              </li>
              <li class="active">
                  <a class="" href="editor.html">
                    <i class=""></i>
                    <span>ดูหน้า Editor</span>
                  </a>
                </li>
          </ul>
        </div>
      </aside>
      <!-- sidebar menu end-->
    <!--main content start-->
    <section id="main-content">
      <section class="wrapper">
        <!--overview start-->
        <div class="row">
          <div class="col-lg-12">
            <h3 class="page-header"><i class="icon_document_alt"></i>เพิ่มข้อมูลผู้ใช้งาน</h3>
            <ol class="breadcrumb">
              <li><i class="icon_document_alt"></i>เพิ่มข้อมูลผู้ใช้งาน User</li>
            </ol>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
            <section class="panel">
              <header class="panel-heading">
                กรุณากรอกข้อมูล
              </header>
              <div class="panel-body">
                <div class="form">
                  <form class="form-validate form-horizontal " id="register_form" method="get" action="">
                    <div class="form-group ">
                        <label for="idna" class="control-label col-lg-2">* รหัสบัตรประชาชน</label>
                        <div class="col-lg-10">
                          <input class=" form-control" id="idna" name="idna" type="text" placeholder="Your ID Card"/>
                        </div>
                      </div>
                    <div class="form-group ">
                      <label for="name" class="control-label col-lg-2">* ชื่อจริง</label>
                      <div class="col-lg-10">
                        <input class=" form-control" id="name" name="fullname" type="text" placeholder="Your Name"/>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="lastname" class="control-label col-lg-2">* นามสกุล</label>
                      <div class="col-lg-10">
                        <input class=" form-control" id="lastname" name="lasname" type="text" placeholder="Your lastName"/>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="phone" class="control-label col-lg-2">* เบอร์โทรศัพท์</label>
                      <div class="col-lg-10">
                        <input class=" form-control" id="phone" name="phone" type="tel" placeholder="Your Telephone Number"/>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="position" class="control-label col-lg-2">* ตำแหน่ง</label>
                      <div class="col-lg-10">
                        <input class=" form-control" id="position" name="position" type="text" placeholder="Your Position"/>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="email" class="control-label col-lg-2">* E-mail</label>
                      <div class="col-lg-10">
                        <input class=" form-control" id="email" name="email" type="email" placeholder="Your E-mail"/>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="password" class="control-label col-lg-2">* Password</label>
                      <div class="col-lg-10">
                        <input class=" form-control" id="password" name="password" type="password" placeholder="Your Password"/>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="role" class="control-label col-lg-2">* สิทธิ์</label>
                      <div class="col-lg-10">
                        <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="role1">
                          <input type="radio" id="role1" class="mdl-radio__button" name="role" value="admin">
                          <span class="mdl-radio__label">admin</span>
                        </label>
                        <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="role2">
                          <input type="radio" id="role2" class="mdl-radio__button" name="role" value="editor">
                          <span class="mdl-radio__label">editor</span>
                        </label>
                        <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="role3">
                          <input type="radio" id="role3" class="mdl-radio__button" name="role" value="analyst">
                          <span class="mdl-radio__label">analyst</span>
                        </label>
                      </div>
                    </div>
                    <div class="form-group ">
                      <label for="pic" class="control-label col-lg-2">* รูปภาพ</label>
                      <div class="col-lg-10">
                          <input type="file" id="fileButton"/>
                        <!-- <input class=" form-control" id="pic" name="pic" type="pic" /> -->
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="col-lg-offset-2 col-lg-10">
                        <button class="btn btn-primary" id="add-data" type="submit">บันทึก</button>
                        <button class="btn btn-default" type="button"><a href="admin.html">ยกเลิก</a></button>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </section>
          </div>
        </div>
        <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
            <!--Configure firebase-->
            <script>
             var config = {
              apiKey: "AIzaSyAzQt8zTPXaL2RT48Z_oLDucPCndXXxmDw",
              authDomain: "gtslogic.firebaseapp.com",
              databaseURL: "https://gtslogic.firebaseio.com",
              projectId: "gtslogic",
              storageBucket: "gtslogic.appspot.com",
              messagingSenderId: "754828374672"
            };
            firebase.initializeApp(config);

               var database = firebase.database();
               var userId = localStorage.getItem("session");

               var fileButton = document.getElementById("fileButton");
                fileButton.addEventListener('change', function(e){
                var file = e.target.files[0];
                var storageRef = firebase.storage().ref(file.name);
                storageRef.put(file);
                thumbnail = "https://firebasestorage.googleapis.com/v0/b/"+config["storageBucket"]+"/o/"+file.name+"?alt=media";
            });

                 var data = [];
                    let check = 'users/data/';
                      firebase.database().ref(check).once('value', function(snapshot){
                        let childData = null;
                        snapshot.forEach(function(childSnapshot){
                          let childKey = childSnapshot.key;
                          childData = childSnapshot.val();

                         // console.log(childData.email);
                          data.push(childData.email);
                        });
                       //console.log(data);
                      });
                      // var dbRef = firebase.database().ref();
                      //   document.getElementById("add-data").onclick = function(e) {
                      //     e.preventDefault();
                      //     add();
                         
                      //     }

                      // function add(){
                      document.getElementById("add-data").onclick = function(e) {
                        var name = document.getElementById('name').value;
                        var lastname = document.getElementById('lastname').value;
                        var position = document.getElementById('position').value;
                        var phone = document.getElementById('phone').value;
                        var role ;
                        if(document.getElementById('role1').checked == true) role="admin";
                        else if(document.getElementById('role2').checked == true) role="editor";
                        else if(document.getElementById('role3').checked == true) role="analyst";
                        var email = document.getElementById('email').value;
                        var password = document.getElementById('password').value;
                        var Password = password;
                        var Email = email;
                        var rootRef = firebase.database().ref();
                        var storesRef = rootRef.child('users/data/');
                        var newStoreRef = storesRef.push();
                        console.log(data);
                        
                        if(data.indexOf(email) > -1)
                        {
                          alert("E-mail นี้มีอยู่ในระบบแล้ว");
                        }
                          else
                          {
                            newStoreRef.set({
                              name: name,
                              lastname: lastname,
                              position: position,
                              phone: phone,
                              role: role,
                              email: email,
                              password: password,
                              thumbnail: thumbnail
                              });
                              alert("เพิ่มข้อมูลสำเร็จ ! ");
                              
                          }
                           var email = document.getElementById('email').value;
                          var password = document.getElementById('password').value;
                          firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
                          // Handle Errors here.
                          var errorCode = error.code;
                          var errorMessage = error.message;
                          if(errorCode == 'auth/weak-password'){
                            alert("Weak Password");
                          }else {
                            alert(errorMessage);
                          }
                          console.log(error);
                        });
                      }

                      // function addAuth(){
                      //   var email = document.getElementById('email').value;
                      //   var password = document.getElementById('password').value;
                      //   firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
                      //     // Handle Errors here.
                      //     var errorCode = error.code;
                      //     var errorMessage = error.message;
                      //     if(errorCode == 'auth/weak-password'){
                      //       alert("Weak Password");
                      //     }else {
                      //       alert(errorMessage);
                      //     }
                      //     console.log(error);
                      //   });
                      // }
                       
                    firebase.database().ref('users/data/' + userId).once('value')
                    .then(function(snapshot) {
                      $("#result").text(snapshot.val().name);
                      console.log(snapshot.val().name);
                      });
                      
                      function logout() {
                        localStorage.removeItem("session");
                        window.location.href = "index.html";
                        }
                        
                        $('input[type ="tel"]').on('keypress', function(){
                          if( $(this).val().length > 9){
                            return false;
                            }
                            });
                            console.log($('input[type ="tel"]'));
                            
                             $('input[name ="idna"]').on('keypress',function(){
                               if($(this).val().length > 12){
                                 return false;
                                 }
                                 });
                                 console.log($('input[name ="idna"]'));
                    </script>
          </body>
  </html>
